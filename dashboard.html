<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    .star {
      background-color: white;
      border-radius: 50%;
      position: absolute;
      animation: twinkling 2s infinite, move 10s infinite;
    }
    @keyframes twinkling {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
    @keyframes move {
      0% { transform: translate(0, 0); }
      100% { transform: translate(30px, 30px); }
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s ease-out forwards;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col relative overflow-x-hidden overflow-y-auto">
  <div id="starfield" class="absolute inset-0 z-0 pointer-events-none overflow-hidden"></div>
  <div class="absolute inset-0 z-0 bg-gradient-to-br from-transparent to-[#1a1a1a]"></div>

  <nav id="navbar" class="w-full flex sticky top-0 justify-between items-center py-4 px-4 z-30 relative">
    <img class="w-32" src="logo.svg" alt="Rave Logo">
    <div class="flex items-center space-x-4">
      <span id="coinDisplay" class="bg-white/5 border border-white/10 px-3 py-1.5 text-sm rounded-md text-white inline-block">Loading Coins...</span>
      <div class="relative z-20">
        <button id="hamburgerBtn" class="text-white focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <div id="hamburgerMenu" class="hidden absolute right-0 mt-2 w-52 bg-white/5 border border-white/10 rounded-lg shadow-lg py-2 z-40">
          <button id="closeMenuBtn" class="w-full text-right pr-4 text-white hover:text-red-400">âœ•</button>
          <a id="redeemLink" href="#" onclick="goToRedeem()" class="flex items-center gap-2 px-4 py-2 pb-6 text-sm text-white hover:text-cyan-300 active:text-cyan-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 512 512"><path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-224c0-35.3-28.7-64-64-64L80 128c-8.8 0-16-7.2-16-16s7.2-16 16-16l368 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L64 32zM416 272a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
            Redeem
          </a>
          <a id="leaderboardBtn" href="#" onclick="goToLeaderboard()" class="flex items-center gap-2 px-4 py-2 text-sm text-white hover:text-cyan-300 active:text-cyan-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 384 512"><path d="M192 0c-41.8 0-77.4 26.7-90.5 64L64 64C28.7 64 0 92.7 0 128L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64l-37.5 0C269.4 26.7 233.8 0 192 0zm0 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64zM72 272a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm104-16l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zM72 368a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm88 0c0-8.8 7.2-16 16-16l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16z"/></svg>
            Leaderboard
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="flex justify-center pt-14 relative z-10">
    <div class="w-32 h-32 flex items-center justify-center duration-1000 ease-out">
      <img src="holl.png" alt="">
    </div>
  </div>

  <div class="z-10 relative flex flex-col items-center justify-center py-6">
    <h1 id="userName" class="text-3xl font-semibold mb-2 bg-gradient-to-b from-gray-600 to-white text-transparent bg-clip-text"></h1>
    <p class="text-gray-300 pb-6" id="userEmail"></p>
  </div>

  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="icon-home" viewBox="0 0 576 512">
      <path d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l0 16.2c0 22.1-17.9 40-40 40l-16 0c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1L416 512l-24 0c-22.1 0-40-17.9-40-40l0-24 0-64c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32 14.3-32 32l0 64 0 24c0 22.1-17.9 40-40 40l-24 0-31.9 0c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2l-16 0c-22.1 0-40-17.9-40-40l0-112c0-.9 0-1.9 .1-2.8l0-69.7-32 0c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/>
    </symbol>
    <symbol id="icon-redeem" viewBox="0 0 512 512">
      <path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-224c0-35.3-28.7-64-64-64L80 128c-8.8 0-16-7.2-16-16s7.2-16 16-16l368 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L64 32zM416 272a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>
    </symbol>
    <symbol id="icon-leaderboard" viewBox="0 0 384 512">
      <path d="M192 0c-41.8 0-77.4 26.7-90.5 64L64 64C28.7 64 0 92.7 0 128L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64l-37.5 0C269.4 26.7 233.8 0 192 0zm0 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64zM72 272a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm104-16l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16s7.2-16 16-16zM72 368a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm88 0c0-8.8 7.2-16 16-16l128 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-128 0c-8.8 0-16-7.2-16-16z"/></svg>
    </symbol>
  </svg>

  <section class="px-4">
    <div class="max-w-xl mx-auto bg-white/5 border border-white/10 rounded-2xl p-6 text-center shadow-lg z-10 relative">
    <h2 class="text-lg font-semibold mb-2">Share your referral link:</h2>
    <div class="flex items-center justify-center gap-2 bg-black/30 px-3 py-2 rounded-lg mb-4">
      <input id="referralLink" class="bg-transparent text-white text-sm w-full outline-none" readonly value="https://earnrave.com/?ref=nwB" />
      <button onclick="
        const referralInput = document.getElementById('referralLink');
        navigator.clipboard.writeText(referralInput.value);
        const button = this;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000); // Revert to 'Copy' after 2 seconds
      " class="bg-white/5 border border-white/10 text-sm px-3 py-1 rounded hover:bg-cyan-600 active:bg-cyan-700">Copy</button>
    </div>
    <div class="mb-2">
      <p class="text-sm text-gray-300 mb-2">Referral Progress:</p>
      <div class="h-3 bg-white/10 rounded-full overflow-hidden">
        <div id="progressBar" class="h-full bg-gradient-to-r from-[#00FFFF] to-blue-600" style="width: 0%;"></div>
      </div>
      <p class="text-sm mt-1 text-gray-200" id="progressText">0/5 referrals (â‚¦100 target)</p>
      <p class="mt-2 text-cyan-400 font-semibold hidden" id="redeemMessage">
        </p>
    </div>
    <p class="mt-4 text-pink-400 font-semibold" id="currentTierGoalMessage">
      Share with 5 friends to win <span class="text-white font-bold">â‚¦100 Airtime!</span>
    </p>
  </div>
  </section>

  <!-- Redeem Button -->
  <div class="flex justify-center my-6 z-10 relative">
    <button id="manualRedeemBtn" class="bg-gradient-to-r from-[#00FFFF] to-blue-600 hover:opacity-90 text-white font-semibold py-3 px-6 rounded-md transition">
      Redeem Now
    </button>
  </div>
  <p id="redeemFeedback" class="text-center text-sm text-yellow-400 mt-2"></p>
  


  <main class="max-w-xl mx-auto pt-12 px-6 z-10 relative pb-28">
    <div class="grid md:grid-cols-2 gap-6 mb-8 fade-in">
      <div class="bg-white/5 border border-white/10 rounded-xl p-6 text-center">
        <h2 class="text-xl font-bold">Invited</h2>
        <p id="invitedCount" class="text-3xl font-semibold text-green-400">0</p>
      </div>
      <div class="bg-white/5 border border-white/10 rounded-xl p-6 text-center">
        <h2 class="text-xl font-bold">Earned</h2>
        <p id="earnedCoins" class="text-3xl font-semibold text-yellow-400">0 RAVE COINS</p>
      </div>
      <div class="bg-white/5 border border-white/10 rounded-xl p-6 text-center">
        <h2 class="text-xl font-bold">Referral Code</h2>
        <p id="referralCode" class="text-xl font-mono text-blue-400 break-words">N/A</p>
      </div>
      <div class="bg-white/5 border border-white/10 rounded-xl p-6 text-center">
        <h2 class="text-xl font-bold">Bonus</h2>
        <p id="bonusStatus" class="text-xl text-purple-400">Not Yet Earned</p>
      </div>
    </div>
  </main>

  <footer class="z-10 w-full text-center py-10 mt-auto border-t border-white/10">
    <div class="flex justify-center space-x-4 mb-4">
      <a href="#" class="text-gray-400 hover:text-white">Twitter</a>
      <a href="#" class="text-gray-400 hover:text-white">Instagram</a>
      <a href="#" class="text-gray-400 hover:text-white">Telegram</a>
    </div>
    <p class="text-gray-500 text-sm">&copy; 2025 EarnRave. All rights reserved.</p>
  </footer>

  <script>
    // Force scroll to top on page load
    window.onload = function() {
      window.scrollTo(0, 0);
    };

    const container = document.getElementById('starfield');
    for (let i = 0; i < 100; i++) {
      const star = document.createElement('div');
      const size = Math.random() * 2 + 1;
      star.className = 'star';
      star.style.width = `${size}px`;
      star.style.height = `${size}px`;
      star.style.top = `${Math.random() * 100}%`;
      star.style.left = `${Math.random() * 100}%`;
      star.style.animationDuration = `${1.5 + Math.random() * 2}s, ${15 + Math.random() * 10}s`;
      container.appendChild(star);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email');
      const name = urlParams.get('name');
      const code = urlParams.get('code');
      const coins = urlParams.get('coins');

      let redeemedTiers = [];

    fetch(`https://pure-sea-47438-9b41a08c5720.herokuapp.com/redemptions/${encodeURIComponent(email)}`)
      .then(res => res.json())
      .then(data => {
        redeemedTiers = data.redeemedTiers || [];
      })
      .catch(err => {
        console.error('Redemption check failed', err);
      });


      if (!email || !name || !code || !coins) return alert('Missing user data in URL.');

      document.getElementById('userName').textContent = `Welcome, ${decodeURIComponent(name)}`;
      document.getElementById('userEmail').textContent = email;
      document.getElementById('coinDisplay').textContent = `${coins} Rave Coins`;

      document.getElementById('leaderboardBtn').href = `leaderboard.html?email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&code=${encodeURIComponent(code)}&coins=${encodeURIComponent(coins)}`;
      document.getElementById('redeemLink').href = `redeem.html?email=${encodeURIComponent(email)}`;

      fetch(`https://pure-sea-47438-9b41a08c5720.herokuapp.com/me?email=${encodeURIComponent(email)}`)
        .then(res => res.json())
        .then(data => {
          const totalReferrals = data.referral_count || 0; // Total lifetime referrals

         
          const redeemBtn = document.getElementById('manualRedeemBtn');
        const feedback = document.getElementById('redeemFeedback');

        redeemBtn.addEventListener('click', () => {
          let redirectAllowed = false;
          let requiredCount = 0;
          let tier = 0;

          if (totalReferrals >= 100) {
            requiredCount = 100;
            tier = 10000;
          } else if (totalReferrals >= 25) {
            requiredCount = 25;
            tier = 500;
          } else if (totalReferrals >= 5) {
            requiredCount = 5;
            tier = 100;
          } else {
            requiredCount = 5;
          }

          // If user hasnâ€™t met referral requirement
          if (totalReferrals < requiredCount) {
            feedback.textContent = `Wait till you complete ${requiredCount}/${requiredCount} referrals. You have ${totalReferrals}/${requiredCount}.`;
            return;
          }

          // Check if tier already redeemed
          if (redeemedTiers.includes(tier)) {
            feedback.textContent = `You've already redeemed the â‚¦${tier} Airtime reward.`;
            return;
          }

          // All clear â€“ redirect
          const redeemUrl = `redeem.html?email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&code=${encodeURIComponent(code)}&coins=${encodeURIComponent(coins)}`;
          window.location.href = redeemUrl;
        });

          
          document.getElementById('invitedCount').textContent = totalReferrals; // Always show total invited
          document.getElementById('earnedCoins').textContent = `${data.rave_coins || 0} RAVE COINS`;
          document.getElementById('referralCode').textContent = data.referral_code || 'N/A';
          document.getElementById('bonusStatus').textContent = data.bonus_awarded ? 'âœ… Earned' : 'Not Yet Earned';

          // --- New Simplified Logic for Tiered Referral Progress ---
          const progressBar = document.getElementById('progressBar');
          const progressText = document.getElementById('progressText');
          const currentTierGoalMessage = document.getElementById('currentTierGoalMessage');
          const redeemMessage = document.getElementById('redeemMessage');

          let displayedProgress = totalReferrals;
          let displayMax = 0;
          let goalAirtimeText = '';
          let airtimeRedeemMessage = '';

          if (totalReferrals < 5) {
            displayMax = 5;
            goalAirtimeText = 'â‚¦100 Airtime!';
            currentTierGoalMessage.innerHTML = `Share with ${displayMax} friends to win <span class="text-white font-bold">${goalAirtimeText}</span>`;
            redeemMessage.classList.add('hidden'); // Hide redeem message until a tier is completed

          } else if (totalReferrals >= 5 && totalReferrals < 25) {
            displayMax = 25;
            goalAirtimeText = 'â‚¦500 Airtime!';
            currentTierGoalMessage.innerHTML = `Share with ${displayMax} friends to win <span class="text-white font-bold">${goalAirtimeText}</span>`;
            // N100 Airtime is earned at 5 referrals
            airtimeRedeemMessage = "ðŸŽ‰ You've reached 5 referrals! Your â‚¦100 Airtime is ready to redeem!";
            redeemMessage.textContent = airtimeRedeemMessage;
            redeemMessage.classList.remove('hidden');

          } else if (totalReferrals >= 25 && totalReferrals < 100) {
            displayMax = 100;
            goalAirtimeText = 'â‚¦10,000 Airtime!';
            currentTierGoalMessage.innerHTML = `Share with ${displayMax} friends to win <span class="text-white font-bold">${goalAirtimeText}</span>`;
            // N500 Airtime is earned at 25 referrals
            airtimeRedeemMessage = "ðŸŽ‰ You've reached 25 referrals! Your â‚¦500 Airtime is ready to redeem!";
            redeemMessage.textContent = airtimeRedeemMessage;
            redeemMessage.classList.remove('hidden');

          } else { // totalReferrals >= 100
            displayMax = 100; // Cap at 100 for display
            displayedProgress = 100; // Ensure progress bar is full
            goalAirtimeText = 'â‚¦10,000 Airtime!';
            currentTierGoalMessage.innerHTML = `Congratulations! You've earned <span class="text-white font-bold">${goalAirtimeText}</span> Keep referring for more coins!`;
            // N10,000 Airtime is earned at 100 referrals
            airtimeRedeemMessage = "ðŸŽ‰ You've reached 100 referrals! Your â‚¦10,000 Airtime is ready to redeem!";
            redeemMessage.textContent = airtimeRedeemMessage;
            redeemMessage.classList.remove('hidden');
          }

          // Update progress bar width based on the current tier's max
          const progressPercentage = (displayedProgress / displayMax) * 100;
          progressBar.style.width = `${progressPercentage}%`;
          
          // Update progress text (e.g., "3/5 referrals (â‚¦100 target)")
          progressText.textContent = `${totalReferrals}/${displayMax} referrals (${goalAirtimeText.replace('!', '')} target)`;
          // --- End New Simplified Logic ---
        })
        .catch(error => {
          console.error('Error fetching user data:', error);
          // Handle error, maybe display a message to the user
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById('hamburgerBtn');
    const menu = document.getElementById('hamburgerMenu');
    const closeBtn = document.getElementById('closeMenuBtn');
    const navbar = document.getElementById('navbar');

    btn.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });

    closeBtn.addEventListener('click', () => {
      menu.classList.add('hidden');
    });

    document.addEventListener('click', function (event) {
      if (!menu.contains(event.target) && !btn.contains(event.target)) {
        menu.classList.add('hidden');
      }
    });

    const links = menu.querySelectorAll('a');
    links.forEach(link => {
      link.addEventListener('click', () => {
        menu.classList.add('hidden');
      });
    });

    window.addEventListener('scroll', function () {
      if (window.scrollY > 10) {
        navbar.classList.add('bg-black', 'border-b', 'border-white/10');
      } else {
        navbar.classList.remove('bg-black', 'border-b', 'border-white/10');
      }
    });
  });

  function goToRedeem() {
  const urlParams = new URLSearchParams(window.location.search);
  const email = urlParams.get('email');
  const name = urlParams.get('name');
  const code = urlParams.get('code');
  const coins = urlParams.get('coins');

  if (!email || !name || !code || !coins) {
    alert('Missing user data');
    return;
  }

  // Navigate with query parameters
  const targetUrl = `redeem.html?email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&code=${encodeURIComponent(code)}&coins=${encodeURIComponent(coins)}`;
  window.location.href = targetUrl;
}

  function goToLeaderboard() {
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get('email');
    const name = urlParams.get('name');
    const code = urlParams.get('code');
    const coins = urlParams.get('coins');

    if (!email || !name || !code || !coins) {
      alert('Missing user data');
      return;
    }
    const targetUrl = `leaderboard.html?email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}&code=${encodeURIComponent(code)}&coins=${encodeURIComponent(coins)}`;
    window.location.href = targetUrl;
  }

  function setActive(tabId) {
      document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('text-cyan-300', 'scale-110'));
      document.getElementById(tabId).classList.add('text-cyan-300', 'scale-110');
    }

  </script>
</body>
</html>